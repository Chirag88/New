//
//  MSALoginViewController.m
//  MySchapp
//
//  Created by CK-Dev on 23/02/16.
//  Copyright Â© 2016 ACA. All rights reserved.
//

#import "MSALoginViewController.h"
#import "MSASignupViewController.h"
#import "MSAConstants.h"
#import "MSACountrySelectViewController.h"

@interface MSALoginViewController ()<NSURLSessionDelegate>
@property (weak, nonatomic) IBOutlet UIButton *forgotPwdBtn;
@property (weak, nonatomic) IBOutlet TTTAttributedLabel *signupMessage;
- (IBAction)closeClicked:(id)sender;
@property (weak, nonatomic) IBOutlet UIButton *closeBtn;
- (IBAction)loginClicked:(id)sender;

@end

@implementation MSALoginViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    [self addAttributesToTextFields];
    // Do any additional setup after loading the view.
    NSMutableAttributedString *titleString = [[NSMutableAttributedString alloc] initWithString:@"Forgot your password?"];
    // making text property to underline text-
    [titleString addAttribute:NSUnderlineStyleAttributeName value:[NSNumber numberWithInteger:(NSUnderlinePatternDot|NSUnderlineStyleSingle)] range:NSMakeRange(0, [titleString length])];
    [titleString addAttribute:NSForegroundColorAttributeName value:[UIColor darkGrayColor] range:NSMakeRange(0, [titleString length])];
    [titleString addAttribute:NSUnderlineColorAttributeName value:[UIColor blueColor] range:NSMakeRange(0, [titleString length])];
    // using text on button
    [self.forgotPwdBtn setAttributedTitle: titleString forState:UIControlStateNormal];
    
    self.signupMessage.delegate = self;
    NSURL *tncUrl = [NSURL URLWithString:[NSString stringWithFormat:@"http://google.com/%@", @""]];
    [self.signupMessage addLinkToURL:tncUrl withRange:NSMakeRange(28, 6)];
    
    [self.view bringSubviewToFront:self.closeBtn];
}

-(void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    self.navigationController.navigationBarHidden = YES;
}

- (void)addAttributesToTextFields
{
    UIImageView *leftViewEmailImg = [[UIImageView alloc] initWithFrame:CGRectMake(5, 5, 20, 20)];
    leftViewEmailImg.image = [UIImage imageNamed:@"icon_emailInactive.png"];
    leftViewEmailImg.contentMode = UIViewContentModeScaleAspectFit;
    UIView *leftViewEmail = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 30, 30)];
    [leftViewEmail addSubview:leftViewEmailImg];
    self.emailField.leftView = leftViewEmail;
    self.emailField.leftViewMode = UITextFieldViewModeAlways;
    
    UIImageView *leftViewPwdImg = [[UIImageView alloc] initWithFrame:CGRectMake(5, 5, 20, 20)];
    leftViewPwdImg.image = [UIImage imageNamed:@"login_iconInactive_password.png"];
    leftViewPwdImg.contentMode = UIViewContentModeScaleAspectFit;
    UIView *leftViewPwd = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 30, 30)];
    [leftViewPwd addSubview:leftViewPwdImg];
    self.pwdField.leftView = leftViewPwd;
    self.pwdField.leftViewMode = UITextFieldViewModeAlways;
}

#pragma mark - TTTAttributedLabelDelegate

- (void)attributedLabel:(__unused TTTAttributedLabel *)label
   didSelectLinkWithURL:(NSURL *)url {
    NSLog(@"clicked");
    
    [self.loginDelegate controllerGotDissmissed:self];

}


- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


- (IBAction)closeClicked:(id)sender {
   
    [self dismissViewControllerAnimated:YES completion:nil];
}
- (IBAction)loginClicked:(id)sender {
    /*
    NSError *error;
    
    NSURLSessionConfiguration *configuration = [NSURLSessionConfiguration defaultSessionConfiguration];
    NSURLSession *session = [NSURLSession sessionWithConfiguration:configuration delegate:self delegateQueue:nil];
    
    NSArray *objects = [NSArray arrayWithObjects:@"c.khatter1988+2@gmail.com",@"296180",nil];
    NSArray *keys = [NSArray arrayWithObjects:@"email", @"otp", nil];

//   NSString *uid = [[[UIDevice currentDevice] identifierForVendor] UUIDString];
//    NSArray *objects = [NSArray arrayWithObjects:@"c.khatter1988+8@gmail.com",@"Pass@123",@"Pass@123",@"y",@"22",@"67",uid,nil];
//    NSArray *keys = [NSArray arrayWithObjects:@"email", @"password",@"confpassword",@"termsconditions",@"latitude",@"longitude",@"uid" ,nil];
    
    NSDictionary *requestDict = [NSDictionary dictionaryWithObjects:objects forKeys:keys];
    
    
    NSURL *url = [NSURL URLWithString:@"http://67.170.250.11:1487/schmobileapp/loginsignup/A26"];
    
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url
                                                           cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:60.0];
    
    NSData *requestData = [NSJSONSerialization dataWithJSONObject:requestDict options:0 error:&error];
    
    [request setHTTPMethod:@"POST"];
    [request setValue:@"application/json" forHTTPHeaderField:@"Accept"];
    [request setValue:@"application/json" forHTTPHeaderField:@"Content-Type"];
    [request setValue:[NSString stringWithFormat:@"%d", [requestData length]] forHTTPHeaderField:@"Content-Length"];
    [request setHTTPBody: requestData];
    
    NSURLSessionDataTask *postDataTask = [session dataTaskWithRequest:request completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {
        NSError *err;
        NSLog(@"%@  --------error%@",[NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingAllowFragments error:&err],error);
        
        
    }];
    
    [postDataTask resume];
    */
    
    BOOL ftl = NO;
    BOOL planShow = YES;
    
    if (ftl) {
        
    }
    else if (planShow) {
        UIStoryboard *mainStoryboard = UISTORYBOARD;

        MSACountrySelectViewController *controller = (MSACountrySelectViewController*)[mainStoryboard
                                                                   instantiateViewControllerWithIdentifier: @"CountrySelectController"];
        [self.navigationController pushViewController:controller animated:YES];
        
    }
    else {
         [self.navigationController dismissViewControllerAnimated:YES completion:nil];
    }
    
    
    
    
    
}
@end
